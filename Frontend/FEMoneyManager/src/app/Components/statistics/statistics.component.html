<div class="statistics-container">
  <div class="statistics-header">
    <div>
      <h1 class="statistics-title">Statisztika</h1>
      <p class="statistics-subtitle">
        Áttekintés a bevételek és kiadások alakulásáról.
      </p>
    </div>
    <div class="statistics-chip" [ngClass]="balanceStatusClass">
      {{ balanceLabel }}
    </div>
  </div>

  <div *ngIf="loading" class="statistics-loading">
    <div class="loading-header">
      <div class="loading-spinner"></div>
      <p class="loading-text">Statisztikák betöltése...</p>
    </div>

    <div class="loading-content">
      <div class="stat-summary-grid">
        <div class="stat-card skeleton-card" *ngFor="let _ of skeletonSummaryCards">
          <div class="skeleton skeleton-circle"></div>
          <div class="space-y-3 w-full">
            <div class="skeleton skeleton-bar w-1/4"></div>
            <div class="skeleton skeleton-bar w-2/3"></div>
            <div class="skeleton skeleton-bar w-1/2"></div>
          </div>
        </div>
      </div>

      <div class="chart-and-breakdown">
        <div class="chart-wrapper skeleton-panel">
          <div class="space-y-3">
            <div class="skeleton skeleton-bar w-1/3"></div>
            <div class="skeleton skeleton-bar w-2/3"></div>
          </div>
          <div class="skeleton chart-skeleton"></div>
        </div>

        <div class="breakdown-card skeleton-panel">
          <div class="space-y-4">
            <div class="skeleton skeleton-bar w-1/2"></div>
            <div class="skeleton-breakdown" *ngFor="let _ of skeletonBreakdownRows">
              <div class="skeleton skeleton-bar w-3/4"></div>
              <div class="skeleton skeleton-bar w-full h-2"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="stat-details-grid">
        <div class="detail-card skeleton-panel" *ngFor="let _ of skeletonDetailCards">
          <div class="skeleton skeleton-bar w-1/3 mb-4"></div>
          <div class="space-y-3">
            <div class="skeleton skeleton-bar w-1/2" *ngFor="let __ of skeletonDetailItems"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-container *ngIf="!loading">
    <ng-container *ngIf="hasTransactions; else emptyState">
      <div class="stat-summary-grid">
        <div class="stat-card income-card">
          <div class="stat-card-icon income-icon">B</div>
          <p class="stat-card-label">Összes bevétel</p>
          <p class="stat-card-value">{{ summary.incomeTotal | currency:'HUF':'symbol':'1.0-0':'hu' }}</p>
          <div class="stat-card-footer">
            <span>{{ summary.incomeCount }} tranzakció</span>
          </div>
        </div>

        <div class="stat-card expense-card">
          <div class="stat-card-icon expense-icon">K</div>
          <p class="stat-card-label">Összes kiadás</p>
          <p class="stat-card-value">{{ summary.expenseTotal | currency:'HUF':'symbol':'1.0-0':'hu' }}</p>
          <div class="stat-card-footer">
            <span>{{ summary.expenseCount }} tranzakció</span>
          </div>
        </div>

        <div class="stat-card balance-card" [ngClass]="balanceStatusClass">
          <div class="stat-card-icon balance-icon">+/-</div>
          <p class="stat-card-label">Eredmény</p>
          <p class="stat-card-value">{{ summary.netBalance | currency:'HUF':'symbol':'1.0-0':'hu' }}</p>
          <div class="stat-card-footer">
            <span>Fedezet: {{ summary.coverage | number:'1.0-0' }}%</span>
            <span>{{ balanceLabel }}</span>
          </div>
        </div>
      </div>

      <div class="chart-and-breakdown">
        <div class="chart-wrapper">
          <h2 class="section-title">Kategóriák összehasonlítása</h2>
          <p class="section-subtitle">
            A bevételek és kiadások kategóriánkénti megoszlása.
          </p>
          <div id="chartContainer" class="chart-container"></div>
        </div>

        <div class="breakdown-card">
          <h2 class="section-title">Legfontosabb kategóriák</h2>

          <div class="breakdown-section">
            <h3 class="breakdown-heading">Bevételek</h3>
            <ng-container *ngIf="topIncomeCategories.length > 0; else noIncomeBreakdown">
              <div *ngFor="let item of topIncomeCategories" class="breakdown-row">
                <div class="breakdown-row-top">
                  <span class="breakdown-name">{{ item.name }}</span>
                  <div class="breakdown-meta">
                    <span class="breakdown-amount">{{ item.amount | currency:'HUF':'symbol':'1.0-0':'hu' }}</span>
                    <span class="breakdown-percentage">{{ item.percentage }}%</span>
                  </div>
                </div>
                <div class="progress">
                  <div class="progress-fill income" [style.width.%]="item.percentage"></div>
                </div>
              </div>
            </ng-container>
          </div>

          <div class="breakdown-section">
            <h3 class="breakdown-heading">Kiadások</h3>
            <ng-container *ngIf="topExpenseCategories.length > 0; else noExpenseBreakdown">
              <div *ngFor="let item of topExpenseCategories" class="breakdown-row">
                <div class="breakdown-row-top">
                  <span class="breakdown-name">{{ item.name }}</span>
                  <div class="breakdown-meta">
                    <span class="breakdown-amount">{{ item.amount | currency:'HUF':'symbol':'1.0-0':'hu' }}</span>
                    <span class="breakdown-percentage">{{ item.percentage }}%</span>
                  </div>
                </div>
                <div class="progress">
                  <div class="progress-fill expense" [style.width.%]="item.percentage"></div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>

      <div class="stat-details-grid ">
        <div class="detail-card">
          <h3 class="detail-title">Bevételi áttekintés</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Tranzakciók száma</span>
              <span class="detail-value">{{ summary.incomeCount }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Legdominánsabb kategória</span>
              <span class="detail-value">{{ topIncomeCategoryName }}</span>
            </div>
          </div>
        </div>

        <div class="detail-card">
          <h3 class="detail-title">Kiadási áttekintés</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Tranzakciók száma</span>
              <span class="detail-value">{{ summary.expenseCount }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Legdominánsabb kategória</span>
              <span class="detail-value">{{ topExpenseCategoryName }}</span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>

  <ng-template #emptyState>
    <div class="statistics-empty">
      <h2>Nincs elegendő tranzakció</h2>
      <p>
        A statisztikák megjelenítéséhez rögzíts legalább egy bevételt vagy kiadást.
      </p>
    </div>
  </ng-template>

  <ng-template #noIncomeBreakdown>
    <p class="empty-breakdown">Nincs bevételi adat.</p>
  </ng-template>

  <ng-template #noExpenseBreakdown>
    <p class="empty-breakdown">Nincs kiadási adat.</p>
  </ng-template>
</div>